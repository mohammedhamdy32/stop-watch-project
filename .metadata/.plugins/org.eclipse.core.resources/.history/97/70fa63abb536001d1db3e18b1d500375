#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>

unsigned char num1=0,num2=0,num3=0,num4=0,num5=0,num6=0;
unsigned int  tick1=0,tick2=0,tick3=0,tick4=0,tick5=0,tick6=0;

void inti_timer1A()
{
	TCCR1B = (1<<WGM12) | (1<<CS12) | (1<<CS10);

	//TCCR1B = (1<<CS12) | (1<<CS10);

	TCNT1 =0;

	OCR1A =244;

	TIMSK |=  (1<<OCIE1A);

	sei(); /* Enable global interrupts in MC */


}

void inti_timer1B()
{
	TCCR1B = (1<<WGM12) | (1<<CS12) | (1<<CS10);

	//TCCR1B = (1<<CS12) | (1<<CS10);

	TCNT1 =0;

	OCR1B =5853;

	TIMSK |=  (1<<OCIE1B);

	sei(); /* Enable global interrupts in MC */

}


ISR (TIMER1_COMPA_vect)
{
	tick1++;
	tick2++;
	tick3++;



	if(tick1==4)
	{
		if(num1==9)
			num1=0;
		else
			num1++;
		tick1=0;
	}

	if(tick2==40)
	{
		if(num2==5)
			num2=0;
		else
			num2++;

		tick2=0;
	}





}

ISR(TIMER1_COMPB_vect)
{
	tick5++;
	tick6++;




			if(num3==9)
				num3=0;
			else
				num3++;




		if(num4==5)
			num4=0;
		else
			num4++;




}



int main(void)
{
	//make enables as output
	DDRA |= (1<<PA0) | (1<<PA1) | (1<<PA2) | (1<<PA3) | (1<<PA4) | (1<<PA5);
	PORTA &= ~(1<<PA0) & ~(1<<PA1) & ~(1<<PA2) & ~(1<<PA3) & ~(1<<PA4) & ~(1<<PA5);

	//make inputs of 7447 as outputs
	DDRC |= (1<<PC0) | (1<<PC1) | (1<<PC2) | (1<<PC3);
	PORTC = (PORTC&0XF0) | (0X00);

	//make INT0,INT1,INT2 as input
	DDRD &= ~(1<<INT0) & (1<<INT0);
	DDRB &= (1<<INT2);

	inti_timer1A();


	for(;;)
	{


		PORTA &= (1<<PA4);
		PORTA = (1<<PA5);
		PORTC=num1;
		_delay_ms(2);


		PORTA &= (1<<PA3);
		PORTA = (1<<PA4);
		PORTC=num2;
		_delay_ms(2);



		PORTA &= (1<<PA2);
		PORTA = (1<<PA3);
		PORTC=num3;
		_delay_ms(2);

		PORTA &= (1<<PA1);
		PORTA = (1<<PA2);
		PORTC=num4;
		_delay_ms(2);


		PORTA &= (1<<PA5) & ~(1<<PA4) & ~(1<<PA3) & ~(1<<PA2) & ~(1<<PA1) ;
		PORTA = (1<<PA1);
		PORTC=num5;
		_delay_ms(2);


		PORTA &= ~(1<<PA5) & ~(1<<PA4) & ~(1<<PA3) & ~(1<<PA2) & ~(1<<PA1) ;  //open fiiedt 7_segment
		PORTA = (1<<PA0);
		PORTC=num6;
		_delay_ms(2);








	}



}

